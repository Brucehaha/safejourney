<html>
<head>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="../lib/Fluster2.packed.js"></script>
<script type="text/javascript">
	
// OnLoad function ...
function initialize() {
  	
	// Create a new map with some default settings
    var myOptions = {
      zoom: 10,
	  center: {lat: -37.8602828, lng: 145.079616},
      mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
	
	// Initialize Fluster and give it a existing map
	var fluster = new Fluster2(map);
	

	 downloadUrl("mapxml.php", function(data) {

	
			var xml = data.responseXML;
			var markers = xml.documentElement.getElementsByTagName("marker");
	
			for (var i = 0; i < markers.length; i++) {
				//var accidentno = markers[i].getAttribute("AccidentNo");
				//var nodeid = markers[i].getAttribute("NodeID");
				var count = markers[i].getAttribute("Count");
				var nodetype = markers[i].getAttribute("NodeType");
				var point = new google.maps.LatLng(
					parseFloat(markers[i].getAttribute("Latitude")),
					parseFloat(markers[i].getAttribute("Longitude")));
					
			// Create a new marker. Don't add it to the map!
			var marker = new google.maps.Marker({
				position: point,
				title: 'Marker ' + i
			});
	
			// Add the marker to the Fluster
			fluster.addMarker(marker);	
				
		   
			}
	
		});  
	
	
	
	
	// Set styles
	// These are the same styles as default, assignment is only for demonstration ...
	fluster.styles = {
		// This style will be used for clusters with more than 0 markers
		0: {
			image: 'http://gmaps-utility-library.googlecode.com/svn/trunk/markerclusterer/1.0/images/m1.png',
			textColor: '#FFFFFF',
			width: 53,
			height: 52
		},
		// This style will be used for clusters with more than 10 markers
		10: {
			image: 'http://gmaps-utility-library.googlecode.com/svn/trunk/markerclusterer/1.0/images/m2.png',
			textColor: '#FFFFFF',
			width: 56,
			height: 55
		},
		20: {
			image: 'http://gmaps-utility-library.googlecode.com/svn/trunk/markerclusterer/1.0/images/m3.png',
			textColor: '#FFFFFF',
			width: 66,
			height: 65
		}
	};
	
	// Initialize Fluster
	// This will set event handlers on the map and calculate clusters the first time.
	fluster.initialize();
	
}

function downloadUrl(url, callback) {
		var request = window.ActiveXObject ?
		new ActiveXObject('Microsoft.XMLHTTP') :
		new XMLHttpRequest;

	request.onreadystatechange = function() {
		if (request.readyState == 4) {
		  request.onreadystatechange = doNothing;
		  callback(request, request.status);
		}
	};
	request.open('GET', url, true);
	request.send(null);
}

function doNothing() {}
        



</script>

</head>
<body onload="initialize()">
<div id="map_canvas" style="width: 600px; height: 400px"></div>
</body>
</html>